n = 20; 
X = linspace(0,1,n)';
y = @(x) sin(2*pi*X);
e = .2*randn(size(X));
Y = y(X) + e;

clearvars -except X Y;
F = 5; % number of features
phi = @(a)(bsxfun(@power,a,0:F-1)); % φ(a) = [1; a]
mu = zeros(F,1);
Sigma = eye(F); 

n = 100; x = linspace(-6,6,n)'; % ‘test’ points
phix = phi(x); % features of x
m = phix * mu;
kxx = phix * Sigma * phix'; % p(fx) = N(m, kxx)
s = bsxfun(@plus,m,chol(kxx + 1.0e-8 * eye(n))' * randn(n,3)); % samples from prior
L = chol(kxx + 1.0e-8 * eye(n));
stdpi = sqrt(diag(kxx)); % marginal stddev, for plotting

M = n; % # dimensions
F = 30; % # frames
x = linspace(-8,8,M)';
s1 = GPanimation(M,F);
s2 = GPanimation(M,F);
s3 = GPanimation(M,F);

N = length(Y); 
sigma=1;
phiX = phi(X); % features of data
M = phiX * mu;
kXX = phiX * Sigma * phiX'; % p(fX) = N(M, kXX)
G = kXX + sigma^2 * eye(N); % p(Y ) = N(M, kXX + σ

R = chol(G); % most expensive step: O(N3

kxX = phix * Sigma * phiX'; % cov(fx, fX) = kxX
A = kxX / R; % pre-compute for re-use
mpost = m + A * (R' \ (Y-M)); % p(fx ∣Y ) = N(m + kxX(kXX + σ
vpost = kxx - A * A'; % kxx − kxX(kXX + σ

spost = bsxfun(@plus,mpost,chol(vpost + 1.0e-8 * eye(n))' * randn(n,3)); % samples
stdpo = sqrt(diag(vpost)); % marginal stddev, for plotting

for f = 1:F
    clf; hold on
     plot(x,mpost + vpost' * s1(:,f),'--');
     plot(x,mpost + vpost' * s2(:,f),'--');
     plot(x,mpost + vpost' * s3(:,f),'--');
    xlim([-8,8]);
    ylim([-14.99,19.99]);
    pause(0.001);
end