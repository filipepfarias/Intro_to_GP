% clear enviroments
close all; clear;

% generating synthetic data
N = 10; SIGMA = .3;
X = linspace(0,1,N)'; X = 
Y = @(x) sin(2*pi*x);
ns = normrnd(0,SIGMA,size(X));
T = Y(X) + ns;

% GP regression

% contructing kernel
F = 200; % number of features
phi = @(x) bsxfun(@power,x,0:F); % basis function
k = @(x,xl) (1e3*exp(-0.25*bsxfun(@minus,x,xl').^2)); % kernel
mu = @(n) zeros(size(n,1),1); % zero mean

n = 100; x = linspace(0,1,n)';
m = mu(x);
kxx = k(x,x);
% s = bsxfun(@plus,m,chol(kxx + 1.0e-8 * eye(n))' * randn(n,3));
% stdpi = sqrt(diag(kxx));

% prior
M = mu(X);
kXX = k(X,X);

G = chol(kXX + SIGMA^2 * eye(N));

A = k(X,x)'/G;

mpost = m + A * (G' \ (T-M));
vpost = kxx - A * A';
stdpost = sqrt(diag(vpost));

% plot
figure;
fplot(Y,[0,1],'LineWidth',1,'Color','blue');
hold on;
plot(X,T,'o','LineWidth',1,'Color','red');
hold on;
plot(x,mpost,'-','LineWidth',1,'Color','red');
hold on;
plot(x,mpost-2*stdpost,'-','LineWidth',1,'Color','green');
hold on;
plot(x,mpost+2*stdpost,'-','LineWidth',1,'Color','green');
hold off;
